https://neo4j.com/developer/

https://neo4j.com/developer/language-guides/?role=developer

https://neo4j.com/developer/example-project/

https://github.com/neo4j-examples?query=movies

	git clone https://github.com/neo4j-examples/movies-java-spring-data-neo4j

Project: movies-java-spring-data-neo4j

	pom.xml
		1: <?xml version="1.0" encoding="UTF-8"?>
		2: <project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
		3: 		 xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd">
		4: 	<modelVersion>4.0.0</modelVersion>
		5: 	<parent>
		6: 		<groupId>org.springframework.boot</groupId>
		7: 		<artifactId>spring-boot-starter-parent</artifactId>
		8: 		<version>2.4.5</version>
		9: 		<relativePath/> <!-- lookup parent from repository -->
	   10: 	</parent>
	   12: 	<groupId>com.neo4j.examples</groupId>
	   13: 	<artifactId>sdn6-movies</artifactId>
	   14: 	<version>0.0.1-SNAPSHOT</version>
	   15: 	<name>SDN6 Movies</name>
	   16: 	<description>Demo web project for Spring Data using Spring Boot and Neo4j</description>
	   18: 	<properties>
	   19: 		<java.version>11</java.version>
	   20: 		<testcontainers.version>1.15.3</testcontainers.version>
	   21: 	</properties>
	   23: 	<dependencies>
	   24: 		<!-- This is everything needed to work with Spring Data Neo4j 6.0. -->
	   25: 		<dependency>
	   26: 			<groupId>org.springframework.boot</groupId>
	   27: 			<artifactId>spring-boot-starter-data-neo4j</artifactId>
	   28: 		</dependency>
	   30: 		<!-- Needed for Springs WebMVC support. -->
	   31: 		<dependency>
	   32: 			<groupId>org.springframework.boot</groupId>
	   33: 			<artifactId>spring-boot-starter-web</artifactId>
	   34: 		</dependency>
	   36: 		<dependency>
	   37: 			<groupId>org.springframework.boot</groupId>
	   38: 			<artifactId>spring-boot-devtools</artifactId>
	   39: 			<scope>runtime</scope>
	   40: 			<optional>true</optional>
	   41: 		</dependency>
	   42: 		<dependency>
	   43: 			<groupId>org.springframework.boot</groupId>
	   44: 			<artifactId>spring-boot-starter-test</artifactId>
	   45: 			<scope>test</scope>
	   46: 		</dependency>
	   48: 		<!-- To bring up a Neo4j instance during test. -->
	   49: 		<dependency>
	   50: 			<groupId>org.testcontainers</groupId>
	   51: 			<artifactId>junit-jupiter</artifactId>
	   52: 			<version>${testcontainers.version}</version>
	   53: 			<scope>test</scope>
	   54: 		</dependency>
	   55: 		<dependency>
	   56: 			<groupId>org.testcontainers</groupId>
	   57: 			<artifactId>neo4j</artifactId>
	   58: 			<version>${testcontainers.version}</version>
	   59: 			<scope>test</scope>
	   60: 		</dependency>
	   61: 	</dependencies>
	   63: 	<build>
	   64: 		<plugins>
	   65: 			<plugin>
	   66: 				<groupId>org.springframework.boot</groupId>
	   67: 				<artifactId>spring-boot-maven-plugin</artifactId>
	   68: 			</plugin>
	   69: 		</plugins>
	   70: 	</build>
	   71: </project>

	src\main\java\movies\spring\data\neo4j\DatabaseConfig.java
		1: package movies.spring.data.neo4j;
		3: import org.springframework.beans.factory.annotation.Value;
		4: import org.springframework.context.annotation.Bean;
		5: import org.springframework.context.annotation.Configuration;
		6: import org.springframework.data.neo4j.core.DatabaseSelection;
		7: import org.springframework.data.neo4j.core.DatabaseSelectionProvider;
		9: @Configuration
	   10: public class DatabaseConfig {
	   12:     /**
	   13:      * Neo4j version-aware database selector.
	   14:      *
	   15:      * This is only needed for applications running with both Neo4j versions 3 (where multitenancy is not available) and 4.
	   16:      *
	   17:      * Ideally, one would run instead (where driver is an instance of org.neo4j.driver.Driver):
	   18:      * <code>
	   19:      *   String neo4jVersion = driver.session().run("RETURN 1").consume().server().version();
	   20:      * </code>
	   21:      * ... but this requires permissions that the user configured by default does not have.
	   22:      *
	   23:      * @param database the configured database name
	   24:      * @return DatabaseSelection the corresponding database name for Neo4j 4+ or undefined otherwise
	   25:      */
	   26:     @Bean
	   27:     DatabaseSelectionProvider databaseSelectionProvider(@Value("${spring.data.neo4j.database}") String database) {
	   28:         return () -> {
	   29:             String neo4jVersion = System.getenv("NEO4J_VERSION");
	   30:             if (neo4jVersion == null || neo4jVersion.startsWith("4")) {
	   31:                 return DatabaseSelection.byName(database);
	   32:             }
	   33:             return DatabaseSelection.undecided();
	   34:         };
	   35:     }
	   36: }

	src\main\java\movies\spring\data\neo4j\SampleMovieApplication.java
		1: package movies.spring.data.neo4j;
		3: import org.springframework.boot.SpringApplication;
		4: import org.springframework.boot.autoconfigure.SpringBootApplication;
		6: /**
		7:  * @author Michael Hunger
		8:  * @author Mark Angrish
		9:  * @author Michael J. Simons
	   10:  */
	   11: @SpringBootApplication
	   12: public class SampleMovieApplication {
	   14:     public static void main(String[] args) {
	   15:         SpringApplication.run(SampleMovieApplication.class, args);
	   16:     }
	   17: }

	src\main\java\movies\spring\data\neo4j\api\MovieController.java
		1: package movies.spring.data.neo4j.api;
		3: import movies.spring.data.neo4j.movies.MovieDetailsDto;
		4: import movies.spring.data.neo4j.movies.MovieResultDto;
		5: import movies.spring.data.neo4j.movies.MovieService;
		6: import org.springframework.web.bind.annotation.GetMapping;
		7: import org.springframework.web.bind.annotation.PathVariable;
		8: import org.springframework.web.bind.annotation.PostMapping;
		9: import org.springframework.web.bind.annotation.RequestParam;
	   10: import org.springframework.web.bind.annotation.RestController;
	   12: import java.util.List;
	   13: import java.util.Map;
	   15: /**
	   16:  * @author Michael J. Simons
	   17:  */
	   18: @RestController
	   19: class MovieController {
	   21: 	private final MovieService movieService;
	   23: 	MovieController(MovieService movieService) {
	   24: 		this.movieService = movieService;
	   25: 	}
	   27: 	@GetMapping("/movie/{title}")
	   28: 	public MovieDetailsDto findByTitle(@PathVariable("title") String title) {
	   29: 		return movieService.fetchDetailsByTitle(title);
	   30: 	}
	   32: 	@PostMapping("/movie/{title}/vote")
	   33: 	public int voteByTitle(@PathVariable("title") String title) {
	   34: 		return movieService.voteInMovieByTitle(title);
	   35: 	}
	   37: 	@GetMapping("/search")
	   38: 	List<MovieResultDto> search(@RequestParam("q") String title) {
	   39: 		return movieService.searchMoviesByTitle(stripWildcards(title));
	   40: 	}
	   42: 	@GetMapping("/graph")
	   43: 	public Map<String, List<Object>> getGraph() {
	   44: 		return movieService.fetchMovieGraph();
	   45: 	}
	   47: 	private static String stripWildcards(String title) {
	   48: 		String result = title;
	   49: 		if (result.startsWith("*")) {
	   50: 			result = result.substring(1);
	   51: 		}
	   52: 		if (result.endsWith("*")) {
	   53: 			result = result.substring(0, result.length() - 1);
	   54: 		}
	   55: 		return result;
	   56: 	}
	   57: }

	src\main\java\movies\spring\data\neo4j\movies\CastMemberDto.java
		1: package movies.spring.data.neo4j.movies;
		3: import java.util.Objects;
		5: public class CastMemberDto {
		7:     private final String name;
		9:     private final String job;
	   11:     private final String role;
	   13:     public CastMemberDto(String name, String job) {
	   14:         this(name, job, null);
	   15:     }
	   17:     // visible for testing
	   18:     CastMemberDto(String name, String job, String role) {
	   19:         this.name = name;
	   20:         this.job = job;
	   21:         this.role = role;
	   22:     }
	   24:     public String getName() {
	   25:         return name;
	   26:     }
	   28:     public String getJob() {
	   29:         return job;
	   30:     }
	   32:     public String getRole() {
	   33:         return role;
	   34:     }
	   36:     public CastMemberDto withRole(String role) {
	   37:         return new CastMemberDto(this.name, this.job, role);
	   38:     }
	   40:     @Override
	   41:     public boolean equals(Object o) {
	   42:         if (this == o) return true;
	   43:         if (o == null || getClass() != o.getClass()) return false;
	   44:         CastMemberDto that = (CastMemberDto) o;
	   45:         return Objects.equals(name, that.name) && Objects.equals(job, that.job) && Objects.equals(role, that.role);
	   46:     }
	   48:     @Override
	   49:     public int hashCode() {
	   50:         return Objects.hash(name, job, role);
	   51:     }
	   52: }

	src\main\java\movies\spring\data\neo4j\movies\Movie.java
		1: package movies.spring.data.neo4j.movies;
		3: import org.springframework.data.neo4j.core.schema.Id;
		4: import org.springframework.data.neo4j.core.schema.Node;
		6: import java.util.List;
		8: /**
		9:  * @author Mark Angrish
	   10:  * @author Michael J. Simons
	   11:  */
	   12: @Node
	   13: public class Movie {
	   15: 	@Id
	   16: 	private final String title;
	   18: 	private final String tagline;
	   20: 	private Integer released;
	   22: 	private Long votes;
	   24: 	public Movie(String title, String tagline) {
	   25: 		this.title = title;
	   26: 		this.tagline = tagline;
	   27: 	}
	   29: 	public String getTitle() {
	   30: 		return title;
	   31: 	}
	   33: 	public String getTagline() {
	   34: 		return tagline;
	   35: 	}
	   37: 	public Integer getReleased() {
	   38: 		return released;
	   39: 	}
	   41: 	public Long getVotes() {
	   42: 		return votes;
	   43: 	}
	   45: 	public void setReleased(Integer released) {
	   46: 		this.released = released;
	   47: 	}
	   49: 	public void setVotes(Long votes) {
	   50: 		this.votes = votes;
	   51: 	}
	   52: }

	src\main\java\movies\spring\data\neo4j\movies\MovieDetailsDto.java
		1: package movies.spring.data.neo4j.movies;
		3: import java.util.List;
		4: import java.util.Objects;
		6: public class MovieDetailsDto {
		8:     private final String title;
	   10:     private final List<CastMemberDto> cast;
	   12:     public MovieDetailsDto(String title, List<CastMemberDto> cast) {
	   13:         this.title = title;
	   14:         this.cast = cast;
	   15:     }
	   17:     public String getTitle() {
	   18:         return title;
	   19:     }
	   21:     public List<CastMemberDto> getCast() {
	   22:         return cast;
	   23:     }
	   25:     @Override
	   26:     public boolean equals(Object o) {
	   27:         if (this == o) return true;
	   28:         if (o == null || getClass() != o.getClass()) return false;
	   29:         MovieDetailsDto that = (MovieDetailsDto) o;
	   30:         return Objects.equals(title, that.title) && Objects.equals(cast, that.cast);
	   31:     }
	   33:     @Override
	   34:     public int hashCode() {
	   35:         return Objects.hash(title, cast);
	   36:     }
	   37: }

	src\main\java\movies\spring\data\neo4j\movies\MovieRepository.java
		1: package movies.spring.data.neo4j.movies;
		3: import org.springframework.data.neo4j.repository.query.Query;
		4: import org.springframework.data.repository.Repository;
		5: import org.springframework.data.repository.query.Param;
		7: import java.util.List;
		9: /**
	   10:  * This repository is indirectly used in the {@code movies.spring.data.neo4j.api.MovieController} via a dedicated movie service.
	   11:  * It is not a public interface to indicate that access is either through the rest resources or through the service.
	   12:  *
	   13:  * @author Michael Hunger
	   14:  * @author Mark Angrish
	   15:  * @author Michael J. Simons
	   16:  */
	   17: interface MovieRepository extends Repository<Movie, String> {
	   19: 	@Query("MATCH (movie:Movie) WHERE movie.title CONTAINS $title RETURN movie")
	   20: 	List<Movie> findSearchResults(@Param("title") String title);
	   21: }

	src\main\java\movies\spring\data\neo4j\movies\MovieResultDto.java
		1: package movies.spring.data.neo4j.movies;
		3: import java.util.Objects;
		5: public class MovieResultDto {
		7:     private final Movie movie;
		9:     public MovieResultDto(Movie movie) {
	   10:         this.movie = movie;
	   11:     }
	   13:     public Movie getMovie() {
	   14:         return movie;
	   15:     }
	   17:     @Override
	   18:     public boolean equals(Object o) {
	   19:         if (this == o) return true;
	   20:         if (o == null || getClass() != o.getClass()) return false;
	   21:         MovieResultDto that = (MovieResultDto) o;
	   22:         return Objects.equals(movie, that.movie);
	   23:     }
	   25:     @Override
	   26:     public int hashCode() {
	   27:         return Objects.hash(movie);
	   28:     }
	   29: }

	src\main\java\movies\spring\data\neo4j\movies\MovieService.java
		1: package movies.spring.data.neo4j.movies;
		3: import org.neo4j.driver.Driver;
		4: import org.neo4j.driver.Session;
		5: import org.neo4j.driver.SessionConfig;
		6: import org.neo4j.driver.Value;
		7: import org.neo4j.driver.types.TypeSystem;
		8: import org.springframework.data.neo4j.core.DatabaseSelectionProvider;
		9: import org.springframework.data.neo4j.core.Neo4jClient;
	   10: import org.springframework.stereotype.Service;
	   12: import java.util.ArrayList;
	   13: import java.util.List;
	   14: import java.util.Map;
	   15: import java.util.Optional;
	   16: import java.util.stream.Collectors;
	   18: /**
	   19:  * @author Michael Hunger
	   20:  * @author Mark Angrish
	   21:  * @author Jennifer Reif
	   22:  * @author Michael J. Simons
	   23:  */
	   24: @Service
	   25: public class MovieService {
	   27: 	private final MovieRepository movieRepository;
	   29: 	private final Neo4jClient neo4jClient;
	   31: 	private final Driver driver;
	   33: 	private final DatabaseSelectionProvider databaseSelectionProvider;
	   35: 	MovieService(MovieRepository movieRepository,
	   36: 				 Neo4jClient neo4jClient,
	   37: 				 Driver driver,
	   38: 				 DatabaseSelectionProvider databaseSelectionProvider) {
	   40: 		this.movieRepository = movieRepository;
	   41: 		this.neo4jClient = neo4jClient;
	   42: 		this.driver = driver;
	   43: 		this.databaseSelectionProvider = databaseSelectionProvider;
	   44: 	}
	   46: 	public MovieDetailsDto fetchDetailsByTitle(String title) {
	   47: 		return this.neo4jClient
	   48: 				.query("" +
	   49: 						"MATCH (movie:Movie {title: $title}) " +
	   50: 						"OPTIONAL MATCH (person:Person)-[r]->(movie) " +
	   51: 						"WITH movie, COLLECT({ name: person.name, job: REPLACE(TOLOWER(TYPE(r)), '_in', ''), role: HEAD(r.roles) }) as cast " +
	   52: 						"RETURN movie { .title, cast: cast }"
	   53: 				)
	   54: 				.in(database())
	   55: 				.bindAll(Map.of("title", title))
	   56: 				.fetchAs(MovieDetailsDto.class)
	   57: 				.mappedBy(this::toMovieDetails)
	   58: 				.one()
	   59: 				.orElse(null);
	   60: 	}
	   62: 	public int voteInMovieByTitle(String title) {
	   63: 		return this.neo4jClient
	   64: 				.query( "MATCH (m:Movie {title: $title}) " +
	   65: 						"WITH m, (CASE WHEN exists(m.votes) THEN m.votes ELSE 0 END) AS currentVotes " +
	   66: 						"SET m.votes = currentVotes + 1;" )
	   67: 				.in( database() )
	   68: 				.bindAll(Map.of("title", title))
	   69: 				.run()
	   70: 				.counters()
	   71: 				.propertiesSet();
	   72: 	}
	   74: 	public List<MovieResultDto> searchMoviesByTitle(String title) {
	   75: 		return this.movieRepository.findSearchResults(title)
	   76: 				.stream()
	   77: 				.map(MovieResultDto::new)
	   78: 				.collect(Collectors.toList());
	   79: 	}
	   81: 	/**
	   82: 	 * This is an example of when you might want to use the pure driver in case you have no need for mapping at all, neither in the
	   83: 	 * form of the way the {@link org.springframework.data.neo4j.core.Neo4jClient} allows and not in form of entities.
	   84: 	 *
	   85: 	 * @return A representation D3.js can handle
	   86: 	 */
	   87: 	public Map<String, List<Object>> fetchMovieGraph() {
	   89: 		var nodes = new ArrayList<>();
	   90: 		var links = new ArrayList<>();
	   92: 		try (Session session = sessionFor(database())) {
	   93: 			var records = session.readTransaction(tx -> tx.run(""
	   94: 				+ " MATCH (m:Movie) <- [r:ACTED_IN] - (p:Person)"
	   95: 				+ " WITH m, p ORDER BY m.title, p.name"
	   96: 				+ " RETURN m.title AS movie, collect(p.name) AS actors"
	   97: 			).list());
	   98: 			records.forEach(record -> {
	   99: 				var movie = Map.of("label", "movie", "title", record.get("movie").asString());
	  101: 				var targetIndex = nodes.size();
	  102: 				nodes.add(movie);
	  104: 				record.get("actors").asList(Value::asString).forEach(name -> {
	  105: 					var actor = Map.of("label", "actor", "title", name);
	  107: 					int sourceIndex;
	  108: 					if (nodes.contains(actor)) {
	  109: 						sourceIndex = nodes.indexOf(actor);
	  110: 					} else {
	  111: 						nodes.add(actor);
	  112: 						sourceIndex = nodes.size() - 1;
	  113: 					}
	  114: 					links.add(Map.of("source", sourceIndex, "target", targetIndex));
	  115: 				});
	  116: 			});
	  117: 		}
	  118: 		return Map.of("nodes", nodes, "links", links);
	  119: 	}
	  121: 	private Session sessionFor(String database) {
	  122: 		if (database == null) {
	  123: 			return driver.session();
	  124: 		}
	  125: 		return driver.session(SessionConfig.forDatabase(database));
	  126: 	}
	  128: 	private String database() {
	  129: 		return databaseSelectionProvider.getDatabaseSelection().getValue();
	  130: 	}
	  132: 	private MovieDetailsDto toMovieDetails(TypeSystem ignored, org.neo4j.driver.Record record) {
	  133: 		var movie = record.get("movie");
	  134: 		return new MovieDetailsDto(
	  135: 				movie.get("title").asString(),
	  136: 				movie.get("cast").asList((member) -> {
	  137: 					var result = new CastMemberDto(
	  138: 							member.get("name").asString(),
	  139: 							member.get("job").asString()
	  140: 					);
	  141: 					var role = member.get("role");
	  142: 					if (role.isNull()) {
	  143: 						return result;
	  144: 					}
	  145: 					return result.withRole(role.asString());
	  146: 				})
	  147: 		);
	  148: 	}
	  149: }

	src\main\resources\application.properties
		1: server.port=${PORT:8080}
		2: spring.neo4j.uri=${NEO4J_URI:neo4j+s://demo.neo4jlabs.com}
		3: spring.neo4j.authentication.username=${NEO4J_USER:movies}
		4: spring.neo4j.authentication.password=${NEO4J_PASSWORD:movies}
		5: spring.data.neo4j.database=${NEO4J_DATABASE:movies}
		6: logging.level.org.springframework.data.neo4j.cypher = trace

	src\main\resources\static\index.html
		1: <html>
		2: <head>
		3:     <meta name="viewport" content="width=device-width, initial-scale=1.0">
		4:     <link rel="stylesheet" href="https://neo4j-documentation.github.io/developer-resources/language-guides/assets/css/main.css">
		5:     <title>Neo4j Movies</title>
		6: </head>
		8: <body>
		9: <div id="graph">
	   10: </div>
	   11: <div role="navigation" class="navbar navbar-default navbar-static-top">
	   12:     <div class="container">
	   13:         <div class="row">
	   14:             <div class="col-sm-6 col-md-6">
	   15:                 <ul class="nav navbar-nav">
	   16:                     <li>
	   17:                         <form role="search" class="navbar-form" id="search">
	   18:                             <div class="form-group">
	   19:                                 <input type="text" value="Matrix" placeholder="Search for Movie Title" class="form-control" name="search">
	   20:                             </div>
	   21:                             <button class="btn btn-default" type="submit">Search</button>
	   22:                         </form>
	   23:                     </li>
	   24:                 </ul>
	   25:             </div>
	   26:             <div class="navbar-header col-sm-6 col-md-6">
	   27:                 <div class="logo-well">
	   28:                     <a href="https://neo4j.com/developer/example-project" target="_blank">
	   29:                     <img src="https://dist.neo4j.com/wp-content/uploads/neo4j_logo_globe1-150x150.png" alt="Neo4j World's Leading Graph Database" id="logo">
	   30:                     </a>
	   31:                 </div>
	   32:                 <div class="navbar-brand">
	   33:                     <div class="brand">Neo4j Movies</div>
	   34:                 </div>
	   35:             </div>
	   36:         </div>
	   37:     </div>
	   38: </div>
	   40: <div class="row">
	   41:     <div class="col-md-5">
	   42:         <div class="panel panel-default">
	   43:             <div class="panel-heading">Search Results</div>
	   44:             <table id="results" class="table table-striped table-hover">
	   45:                 <thead>
	   46:                 <tr>
	   47:                     <th>Movie</th>
	   48:                     <th>Released</th>
	   49:                     <th>Tagline</th>
	   50:                     <th>Votes</th>
	   51:                 </tr>
	   52:                 </thead>
	   53:                 <tbody>
	   54:                 </tbody>
	   55:             </table>
	   56:         </div>
	   57:     </div>
	   58:     <div class="col-md-7">
	   59:         <div class="panel panel-default">
	   60:             <div class="panel-heading" id="title">Details</div>
	   61:             <div class="row">
	   62:                 <div class="col-sm-4 col-md-4">
	   63:                     <img src="" class="well" id="poster"/>
	   64:                 </div>
	   65:                 <div class="col-md-8 col-sm-8">
	   66:                     <h4>Crew</h4>
	   67:                     <ul id="crew">
	   68:                     </ul>
	   69:                 </div>
	   70:             </div>
	   71:             <div class="panel-footer"><button id="vote">Vote</button></div>
	   72:         </div>
	   73:     </div>
	   74: </div>
	   75: <style type="text/css">
	   76:     .node { stroke: #222; stroke-width: 1.5px; }
	   77:     .node.actor { fill: #888; }
	   78:     .node.movie { fill: #BBB; }
	   79:     .link { stroke: #999; stroke-opacity: .6; stroke-width: 1px; }
	   80: </style>
	   82: <script type="text/javascript" src="//code.jquery.com/jquery-1.11.0.min.js"></script>
	   83: <script src="https://d3js.org/d3.v3.min.js" type="text/javascript"></script>
	   84: <script type="text/javascript">
	   85:     $(function () {
	   86:         function showMovie(title) {
	   87:             $.get("/movie/" + encodeURIComponent(title),
	   88:                     function (data) {
	   89:                         if (!data) return;
	   90:                         $("#title").text(data.title);
	   91:                         $("#poster").attr("src","http://neo4j-documentation.github.io/developer-resources/language-guides/assets/posters/"+encodeURIComponent(data.title)+".jpg");
	   92:                         var $list = $("#crew").empty();
	   93:                         data.cast.forEach(function (cast) {
	   94:                             $list.append($("<li>" + cast.name + " " +cast.job + (cast.job == "acted"?" as " + cast.role : "") + "</li>"));
	   95:                         });
	   96:                         $("#vote")
	   97:                             .unbind("click")
	   98:                             .click(function () {
	   99:                                 voteInMovie(data.title)
	  100:                             });
	  101:                     }, "json");
	  102:             return false;
	  103:         }
	  104:         function search(showFirst = true) {
	  105:             var query=$("#search").find("input[name=search]").val();
	  106:             $.get("/search?q=" + encodeURIComponent(query),
	  107:                     function (data) {
	  108:                         var t = $("table#results tbody").empty();
	  109:                         if (!data || data.length == 0) return;
	  110:                         data.forEach(function (row, index) {
	  111:                             var movie = row.movie
	  112:                             $("<tr><td class='movie'>" + movie.title
	  113:                                 + "</td><td>" + movie.released
	  114:                                 + "</td><td>" + movie.tagline
	  115:                                 + "</td><td id='votes" + index + "'>" + (movie.votes || 0)
	  116:                                 + "</td></tr>").appendTo(t)
	  117:                                 .click(function() { showMovie($(this).find("td.movie").text());})
	  118:                         });
	  119:                         if (showFirst) {
	  120:                             showMovie(data[0].movie.title);
	  121:                         }
	  122:                     }, "json");
	  123:             return false;
	  124:         }
	  125:         function voteInMovie(title) {
	  126:             $.post("/movie/" + encodeURIComponent(title) + "/vote", () => {
	  127:                 search(false);
	  128:                 showMovie(title);
	  129:             });
	  130:         }
	  132:         $("#search").submit(search);
	  133:         search();
	  134:     })
	  135: </script>
	  137: <script type="text/javascript">
	  138:     var width = 800, height = 800;
	  140:     var force = d3.layout.force()
	  141:             .charge(-200).linkDistance(30).size([width, height]);
	  143:     var svg = d3.select("#graph").append("svg")
	  144:             .attr("width", "100%").attr("height", "100%")
	  145:             .attr("pointer-events", "all");
	  147:     d3.json("/graph", function(error, graph) {
	  148: 		if (error) return;
	  150:         force.nodes(graph.nodes).links(graph.links).start();
	  152:         var link = svg.selectAll(".link")
	  153:                 .data(graph.links).enter()
	  154:                 .append("line").attr("class", "link");
	  156:         var node = svg.selectAll(".node")
	  157:                 .data(graph.nodes).enter()
	  158:                 .append("circle")
	  159:                 .attr("class", function (d) { return "node "+d.label })
	  160:                 .attr("r", 10)
	  161:                 .call(force.drag);
	  163:         // html title attribute
	  164:         node.append("title")
	  165:                 .text(function (d) { return d.title; })
	  167:         // force feed algo ticks
	  168:         force.on("tick", function() {
	  169:             link.attr("x1", function(d) { return d.source.x; })
	  170:                     .attr("y1", function(d) { return d.source.y; })
	  171:                     .attr("x2", function(d) { return d.target.x; })
	  172:                     .attr("y2", function(d) { return d.target.y; });
	  174:             node.attr("cx", function(d) { return d.x; })
	  175:                     .attr("cy", function(d) { return d.y; });
	  176:         });
	  177:     });
	  178: </script>
	  179: </body>
	  180: </html>

	src\test\java\movies\spring\data\neo4j\movies\MovieServiceTest.java
		1: package movies.spring.data.neo4j.movies;
		3: import org.junit.jupiter.api.BeforeEach;
		4: import org.junit.jupiter.api.Test;
		5: import org.neo4j.driver.Driver;
		6: import org.neo4j.driver.Session;
		7: import org.springframework.beans.factory.annotation.Autowired;
		8: import org.springframework.boot.test.context.SpringBootTest;
		9: import org.springframework.test.context.DynamicPropertyRegistry;
	   10: import org.springframework.test.context.DynamicPropertySource;
	   11: import org.testcontainers.containers.Neo4jContainer;
	   12: import org.testcontainers.junit.jupiter.Container;
	   13: import org.testcontainers.junit.jupiter.Testcontainers;
	   15: import java.util.List;
	   16: import java.util.Map;
	   18: import static org.assertj.core.api.Assertions.assertThat;
	   20: @Testcontainers
	   21: @SpringBootTest
	   22: class MovieServiceTest {
	   24:     private static final String PASSWORD = "foobar";
	   26:     @Container
	   27:     private static final Neo4jContainer<?> neo4jContainer = new Neo4jContainer<>("neo4j:" + env("NEO4J_VERSION", "4.2"))
	   28:             .withAdminPassword(PASSWORD);
	   30:     @DynamicPropertySource
	   31:     static void neo4jProperties(DynamicPropertyRegistry registry) {
	   32:         registry.add("spring.neo4j.uri", neo4jContainer::getBoltUrl);
	   33:         registry.add("spring.neo4j.authentication.username", () -> "neo4j");
	   34:         registry.add("spring.neo4j.authentication.password", () -> PASSWORD);
	   35:         registry.add("spring.data.neo4j.database", () -> "neo4j");
	   36:     }
	   38:     @BeforeEach
	   39:     void setup(@Autowired Driver driver) {
	   40:         try (Session session = driver.session()) {
	   41:             session.writeTransaction(tx -> {
	   42:                 tx.run("MATCH (n) DETACH DELETE n");
	   43:                 tx.run(""
	   44:                         + "CREATE (TheMatrix:Movie {title:'The Matrix', released:1999, tagline:'Welcome to the Real World'})\n"
	   45:                         + "CREATE (TheMatrixReloaded:Movie {title:'The Matrix Reloaded', released:2003, tagline:'Free your mind'})\n"
	   46:                         + "CREATE (TheMatrixRevolutions:Movie {title:'The Matrix Revolutions', released:2003, tagline:'Everything that has a beginning has an end'})\n"
	   47:                         + "CREATE (p:Person {name: 'Keanu Reeves', born: 1964}) -[:ACTED_IN {roles: ['Neo']}]-> (TheMatrix)\n");
	   48:                 return null;
	   49:             });
	   50:         }
	   51:     }
	   53:     @Test
	   54:     public void searches_movies_by_title(@Autowired MovieService service) {
	   55:         String title = "Matrix Re";
	   56:         assertThat(service.searchMoviesByTitle(title))
	   57:                 .hasSize(2)
	   58:                 .extracting(mr -> mr.getMovie().getTitle()).containsExactlyInAnyOrder("The Matrix Reloaded", "The Matrix Revolutions");
	   59:     }
	   61:     @Test
	   62:     public void fetches_movie_details(@Autowired MovieService service) {
	   63:         MovieDetailsDto details = service.fetchDetailsByTitle("The Matrix");
	   65:         assertThat(details.getTitle()).isEqualTo("The Matrix");
	   66:         assertThat(details.getCast()).containsExactly(new CastMemberDto("Keanu Reeves", "acted", "Neo"));
	   67:     }
	   69:     @Test
	   70:     public void fetches_d3_graph(@Autowired MovieService service) {
	   71:         Map<String, List<Object>> d3Graph = service.fetchMovieGraph();
	   73:         assertThat(d3Graph).isEqualTo(
	   74:                 Map.of(
	   75:                         "links", List.of(
	   76:                                 Map.of("source", 1, "target", 0)
	   77:                         ),
	   78:                         "nodes", List.of(
	   79:                                 Map.of("label", "movie", "title", "The Matrix"),
	   80:                                 Map.of("label", "actor", "title", "Keanu Reeves")
	   81:                         )
	   82:                 ));
	   83:     }
	   85:     private static String env(String name, String defaultValue) {
	   86:         String value = System.getenv(name);
	   87:         if (value == null) {
	   88:             return defaultValue;
	   89:         }
	   90:         return value;
	   91:     }
	   92: }

	git clone https://github.com/neo4j-examples/movies-javascript-bolt

Project: movies-javascript-bolt

    package-lock.json

    package.json
        1: {
        2:   "name": "movies-neo4j-javascript-driver",
        3:   "version": "0.0.1",
        4:   "description": "Demo application using Neo4j Driver for Javascript",
        5:   "repository": "",
        6:   "license": "Apache-2.0",
        7:   "private": true,
        8:   "dependencies": {
        9:     "lodash": "^4.17.21",
       10:     "neo4j-driver": "^4.3.0"
       11:   },
       12:   "devDependencies": {
       13:     "css-loader": "^5.2.6",
       14:     "file-loader": "^6.2.0",
       15:     "html-webpack-plugin": "^5.3.1",
       16:     "rimraf": "^3.0.2",
       17:     "webpack": "^5.38.1",
       18:     "webpack-cli": "^4.7.2",
       19:     "webpack-dev-server": "^3.11.2"
       20:   },
       21:   "scripts": {
       22:     "clean": "rimraf build",
       23:     "build": "webpack",
       24:     "start": "webpack serve"
       25:   }
       26: }

    src\app.js
        1: require('file-loader?name=[name].[ext]!./assets/images/favicon.ico')
        2: const api = require('./neo4jApi');
        4: $(function () {
        5:   renderGraph();
        6:   search();
        8:   $("#search").submit(e => {
        9:     e.preventDefault();
       10:     search();
       11:   });
       12: });
       14: function showMovie(title) {
       15:   api
       16:     .getMovie(title)
       17:     .then(movie => {
       18:       if (!movie) return;
       20:       $("#title").text(movie.title);
       21:       $("#poster").attr("src","https://neo4j-documentation.github.io/developer-resources/language-guides/assets/posters/"+encodeURIComponent(movie.title)+".jpg");
       22:       const $list = $("#crew").empty();
       23:       movie.cast.forEach(cast => {
       24:         $list.append($("<li>" + cast.name + " " + cast.job + (cast.job === "acted" ? " as " + cast.role : "") + "</li>"));
       25:       });
       26:       $("#vote")
       27:         .unbind("click")
       28:         .click(function () {
       29:           voteInMovie(movie.title)
       30:         })
       31:     }, "json");
       32: }
       34: function voteInMovie(title) {
       35:   api.voteInMovie(title)
       36:     .then(() => search(false))
       37:     .then(() => showMovie(title));
       38: }
       40: function search(showFirst = true) {
       41:   const query = $("#search").find("input[name=search]").val();
       42:   api
       43:     .searchMovies(query)
       44:     .then(movies => {
       45:       const t = $("table#results tbody").empty();
       47:       if (movies) {
       48:         movies.forEach((movie, index) => {
       49:           $('<tr>' +
       50:               `<td class='movie'>${movie.title}</td>` +
       51:               `<td>${movie.released}</td>` +
       52:               `<td>${movie.tagline}</td>` +
       53:               `<td id='votes${index}'>${movie.votes}</td>` +
       54:             '</tr>')
       55:             .appendTo(t)
       56:             .click(function() {
       57:               showMovie($(this).find("td.movie").text());
       58:             })
       59:         });
       61:         const first = movies[0];
       62:         if (first && showFirst) {
       63:           return showMovie(first.title);
       64:         }
       65:       }
       66:     });
       67: }
       69: function renderGraph() {
       70:   const width = 800, height = 800;
       71:   const force = d3.layout.force()
       72:     .charge(-200).linkDistance(30).size([width, height]);
       74:   const svg = d3.select("#graph").append("svg")
       75:     .attr("width", "100%").attr("height", "100%")
       76:     .attr("pointer-events", "all");
       78:   api
       79:     .getGraph()
       80:     .then(graph => {
       81:       force.nodes(graph.nodes).links(graph.links).start();
       83:       const link = svg.selectAll(".link")
       84:         .data(graph.links).enter()
       85:         .append("line").attr("class", "link");
       87:       const node = svg.selectAll(".node")
       88:         .data(graph.nodes).enter()
       89:         .append("circle")
       90:         .attr("class", d => {
       91:           return "node " + d.label
       92:         })
       93:         .attr("r", 10)
       94:         .call(force.drag);
       96:       // html title attribute
       97:       node.append("title")
       98:         .text(d => {
       99:           return d.title;
      100:         });
      102:       // force feed algo ticks
      103:       force.on("tick", () => {
      104:         link.attr("x1", d => {
      105:           return d.source.x;
      106:         }).attr("y1", d => {
      107:           return d.source.y;
      108:         }).attr("x2", d => {
      109:           return d.target.x;
      110:         }).attr("y2", d => {
      111:           return d.target.y;
      112:         });
      114:         node.attr("cx", d => {
      115:           return d.x;
      116:         }).attr("cy", d => {
      117:           return d.y;
      118:         });
      119:       });
      120:     });
      121: }

    src\assets\index.html
        1: <!DOCTYPE html>
        2: <html lang="en">
        3: <head>
        4:     <meta charset="UTF-8">
        5:     <meta name="viewport" content="width=device-width, initial-scale=1.0">
        6:     <link rel="stylesheet" href="https://neo4j-documentation.github.io/developer-resources/language-guides/assets/css/main.css">
        7:     <link rel="shortcut icon" href="favicon.ico">
        8:     <title>Neo4j Movies</title>
        9: </head>
       11: <body>
       12: <div id="graph">
       13: </div>
       14: <div role="navigation" class="navbar navbar-default navbar-static-top">
       15:     <div class="container">
       16:         <div class="row">
       17:             <div class="col-sm-6 col-md-6">
       18:                 <ul class="nav navbar-nav">
       19:                     <li>
       20:                         <form role="search" class="navbar-form" id="search">
       21:                             <div class="form-group">
       22:                                 <input type="text" value="Matrix" placeholder="Search for Movie Title" class="form-control" name="search">
       23:                             </div>
       24:                             <button class="btn btn-default" type="submit">Search</button>
       25:                         </form>
       26:                     </li>
       27:                 </ul>
       28:             </div>
       29:             <div class="navbar-header col-sm-6 col-md-6">
       30:                 <div class="logo-well">
       31:                     <a href="http://neo4j.com/developer/example-project" target="_blank">
       32:                         <img src="https://dist.neo4j.com/wp-content/uploads/neo4j_logo_globe1-150x150.png" alt="Neo4j World's Leading Graph Database" id="logo">
       33:                     </a>
       34:                 </div>
       35:                 <div class="navbar-brand">
       36:                     <div class="brand">Neo4j Movies</div>
       37:                 </div>
       38:             </div>
       39:         </div>
       40:     </div>
       41: </div>
       43: <div class="row">
       44:     <div class="col-md-5">
       45:         <div class="panel panel-default">
       46:             <div class="panel-heading">Search Results</div>
       47:             <table id="results" class="table table-striped table-hover">
       48:                 <thead>
       49:                 <tr>
       50:                     <th>Movie</th>
       51:                     <th>Released</th>
       52:                     <th>Tagline</th>
       53:                     <th>Votes</th>
       54:                 </tr>
       55:                 </thead>
       56:                 <tbody>
       57:                 </tbody>
       58:             </table>
       59:         </div>
       60:     </div>
       61:     <div class="col-md-7">
       62:         <div class="panel panel-default">
       63:             <div class="panel-heading" id="title">Details</div>
       64:             <div class="row">
       65:                 <div class="col-sm-4 col-md-4">
       66:                     <img src="" class="well" id="poster"/>
       67:                 </div>
       68:                 <div class="col-md-8 col-sm-8">
       69:                     <h4>Crew</h4>
       70:                     <ul id="crew">
       71:                     </ul>
       72:                 </div>
       73:             </div>
       74:             <div class="panel-footer"><button id="vote">Vote</button></div>
       75:         </div>
       76:     </div>
       77: </div>
       78: <style type="text/css">
       79:     .node { stroke: #222; stroke-width: 1.5px; }
       80:     .node.actor { fill: #888; }
       81:     .node.movie { fill: #BBB; }
       82:     .link { stroke: #999; stroke-opacity: .6; stroke-width: 1px; }
       83: </style>
       85: <script type="text/javascript" src="//code.jquery.com/jquery-1.11.0.min.js"></script>
       86: <script src="https://d3js.org/d3.v3.min.js" type="text/javascript"></script>
       87: <script type="text/javascript" src="neo4j-web.min.js"></script>
       88: </body>
       89: </html>

    src\models\Movie.js
        1: const _ = require('lodash');
        3: function Movie(_node) {
        4:   _.extend(this, _node.properties);
        6:   if (this.id) {
        7:     this.id = this.id.toNumber();
        8:   }
        9:   if (this.duration) {
       10:     this.duration = this.duration.toNumber();
       11:   }
       12:   if (this.votes) {
       13:     this.votes = this.votes.toNumber();
       14:   } else {
       15:     this.votes = 0;
       16:   }
       17: }
       19: module.exports = Movie;

    src\models\MovieCast.js
        1: const _ = require('lodash');
        3: function MovieCast(title, cast) {
        4:   _.extend(this, {
        5:     title: title,
        6:     cast: cast.map(function (c) {
        7:       return {
        8:         name: c[0],
        9:         job: c[1],
       10:         role: c[2]
       11:       }
       12:     })
       13:   });
       14: }
       16: module.exports = MovieCast;

    src\neo4jApi.js
        1: require('file-loader?name=[name].[ext]!../node_modules/neo4j-driver/lib/browser/neo4j-web.min.js');
        2: const Movie = require('./models/Movie');
        3: const MovieCast = require('./models/MovieCast');
        4: const _ = require('lodash');
        6: const neo4j = window.neo4j;
        7: const neo4jUri = process.env.NEO4J_URI;
        8: let neo4jVersion = process.env.NEO4J_VERSION;
        9: if (neo4jVersion === '') {
       10:   // assume Neo4j 4 by default
       11:   neo4jVersion = '4';
       12: }
       13: let database = process.env.NEO4J_DATABASE;
       14: if (!neo4jVersion.startsWith("4")) {
       15:   database = null;
       16: }
       17: const driver = neo4j.driver(
       18:     neo4jUri,
       19:     neo4j.auth.basic(process.env.NEO4J_USER, process.env.NEO4J_PASSWORD),
       20: );
       22: console.log(`Database running at ${neo4jUri}`)
       24: function searchMovies(queryString) {
       25:   const session = driver.session({database: database});
       26:   return session.readTransaction((tx) =>
       27:       tx.run('MATCH (movie:Movie) \
       28:       WHERE movie.title =~ $title \
       29:       RETURN movie',
       30:       {title: '(?i).*' + queryString + '.*'})
       31:     )
       32:     .then(result => {
       33:       return result.records.map(record => {
       34:         return new Movie(record.get('movie'));
       35:       });
       36:     })
       37:     .catch(error => {
       38:       throw error;
       39:     })
       40:     .finally(() => {
       41:       return session.close();
       42:     });
       43: }
       45: function getMovie(title) {
       46:   const session = driver.session({database: database});
       47:   return session.readTransaction((tx) =>
       48:       tx.run("MATCH (movie:Movie {title:$title}) \
       49:       OPTIONAL MATCH (movie)<-[r]-(person:Person) \
       50:       RETURN movie.title AS title, \
       51:       collect([person.name, \
       52:            head(split(toLower(type(r)), '_')), r.roles]) AS cast \
       53:       LIMIT 1", {title}))
       54:     .then(result => {
       55:       if (_.isEmpty(result.records))
       56:         return null;
       58:       const record = result.records[0];
       59:       return new MovieCast(record.get('title'), record.get('cast'));
       60:     })
       61:     .catch(error => {
       62:       throw error;
       63:     })
       64:     .finally(() => {
       65:       return session.close();
       66:     });
       67: }
       69: function voteInMovie(title) {
       70:   const session = driver.session({ database: database });
       71:   return session.writeTransaction((tx) =>
       72:       tx.run("MATCH (m:Movie {title: $title}) \
       73:         WITH m, (CASE WHEN exists(m.votes) THEN m.votes ELSE 0 END) AS currentVotes \
       74:         SET m.votes = currentVotes + 1;", { title }))
       75:     .then(result => {
       76:       return result.summary.counters.updates().propertiesSet
       77:     })
       78:     .finally(() => {
       79:       return session.close();
       80:     });
       81: }
       83: function getGraph() {
       84:   const session = driver.session({database: database});
       85:   return session.readTransaction((tx) =>
       86:     tx.run('MATCH (m:Movie)<-[:ACTED_IN]-(a:Person) \
       87:     RETURN m.title AS movie, collect(a.name) AS cast \
       88:     LIMIT $limit', {limit: neo4j.int(100)}))
       89:     .then(results => {
       90:       const nodes = [], rels = [];
       91:       let i = 0;
       92:       results.records.forEach(res => {
       93:         nodes.push({title: res.get('movie'), label: 'movie'});
       94:         const target = i;
       95:         i++;
       97:         res.get('cast').forEach(name => {
       98:           const actor = {title: name, label: 'actor'};
       99:           let source = _.findIndex(nodes, actor);
      100:           if (source === -1) {
      101:             nodes.push(actor);
      102:             source = i;
      103:             i++;
      104:           }
      105:           rels.push({source, target})
      106:         })
      107:       });
      109:       return {nodes, links: rels};
      110:     })
      111:     .catch(error => {
      112:       throw error;
      113:     })
      114:     .finally(() => {
      115:       return session.close();
      116:     });
      117: }
      119: exports.searchMovies = searchMovies;
      120: exports.getMovie = getMovie;
      121: exports.getGraph = getGraph;
      122: exports.voteInMovie = voteInMovie;

    webpack.config.js
        1: 'use strict';
        3: const Webpack = require('webpack');
        4: const path = require('path');
        5: const HtmlWebpackPlugin = require('html-webpack-plugin');
        7: const buildDirectory = path.join(__dirname, 'build');
        9: module.exports = {
       10:   mode: 'development',
       11:   entry: {
       12:     app: './src/app.js'
       13:   },
       14:   output: {
       15:     filename: 'app.js',
       16:     path: buildDirectory,
       17:   },
       18:   devtool: false,
       19:   devServer: {
       20:     contentBase: buildDirectory,
       21:     port: process.env.PORT || 8080
       22:   },
       24:   stats: {
       25:     colors: true,
       26:     reasons: true
       27:   },
       29:   plugins: [
       30:     new HtmlWebpackPlugin({template: 'src/assets/index.html'}),
       31:     new Webpack.EnvironmentPlugin({
       32:       'NEO4J_URI': 'neo4j+s://demo.neo4jlabs.com',
       33:       'NEO4J_DATABASE': 'movies',
       34:       'NEO4J_USER': 'movies',
       35:       'NEO4J_PASSWORD': 'movies',
       36:       'NEO4J_VERSION': ''
       37:     })
       38:   ],
       40:   resolve: {
       41:     extensions: ['.webpack.js', '.web.js', '.js', '.jsx']
       42:   },
       44:   module: {
       45:     rules: [
       46:       {
       47:         test: /\.css$/i,
       48:         use: ['style-loader', 'css-loader'],
       49:       },
       50:       {
       51:         test: /\.(png|svg|ico|jpe?g|gif)$/i,
       52:         use: [
       53:           {
       54:             loader: 'file-loader',
       55:           },
       56:         ],
       57:       },
       58:     ]
       59:   },
       60: };

	git clone https://github.com/neo4j-examples/movies-python-bolt

Project: movies-python-bolt

	movies.py
		1: #!/usr/bin/env python
		2: import os
		3: from json import dumps
		4: import logging
		6: from flask import Flask, g, Response, request
		7: from neo4j import GraphDatabase, basic_auth
		9: app = Flask(__name__, static_url_path='/static/')
	   11: url = os.getenv("NEO4J_URI", "neo4j+s://demo.neo4jlabs.com")
	   12: username = os.getenv("NEO4J_USER", "movies")
	   13: password = os.getenv("NEO4J_PASSWORD", "movies")
	   14: neo4jVersion = os.getenv("NEO4J_VERSION", "4")
	   15: database = os.getenv("NEO4J_DATABASE", "movies")
	   17: port = os.getenv("PORT", 8080)
	   19: driver = GraphDatabase.driver(url, auth=basic_auth(username, password))
	   22: def get_db():
	   23:     if not hasattr(g, 'neo4j_db'):
	   24:         if neo4jVersion.startswith("4"):
	   25:             g.neo4j_db = driver.session(database=database)
	   26:         else:
	   27:             g.neo4j_db = driver.session()
	   28:     return g.neo4j_db
	   31: @app.teardown_appcontext
	   32: def close_db(error):
	   33:     if hasattr(g, 'neo4j_db'):
	   34:         g.neo4j_db.close()
	   37: @app.route("/")
	   38: def get_index():
	   39:     return app.send_static_file('index.html')
	   42: def serialize_movie(movie):
	   43:     return {
	   44:         'id': movie['id'],
	   45:         'title': movie['title'],
	   46:         'summary': movie['summary'],
	   47:         'released': movie['released'],
	   48:         'duration': movie['duration'],
	   49:         'rated': movie['rated'],
	   50:         'tagline': movie['tagline'],
	   51:         'votes': movie.get('votes', 0)
	   52:     }
	   55: def serialize_cast(cast):
	   56:     return {
	   57:         'name': cast[0],
	   58:         'job': cast[1],
	   59:         'role': cast[2]
	   60:     }
	   63: @app.route("/graph")
	   64: def get_graph():
	   65:     db = get_db()
	   66:     results = db.read_transaction(lambda tx: list(tx.run("MATCH (m:Movie)<-[:ACTED_IN]-(a:Person) "
	   67:                                                          "RETURN m.title as movie, collect(a.name) as cast "
	   68:                                                          "LIMIT $limit", {
	   69:                                                              "limit": request.args.get("limit",
	   70:                                                                                        100)})))
	   71:     nodes = []
	   72:     rels = []
	   73:     i = 0
	   74:     for record in results:
	   75:         nodes.append({"title": record["movie"], "label": "movie"})
	   76:         target = i
	   77:         i += 1
	   78:         for name in record['cast']:
	   79:             actor = {"title": name, "label": "actor"}
	   80:             try:
	   81:                 source = nodes.index(actor)
	   82:             except ValueError:
	   83:                 nodes.append(actor)
	   84:                 source = i
	   85:                 i += 1
	   86:             rels.append({"source": source, "target": target})
	   87:     return Response(dumps({"nodes": nodes, "links": rels}),
	   88:                     mimetype="application/json")
	   91: @app.route("/search")
	   92: def get_search():
	   93:     try:
	   94:         q = request.args["q"]
	   95:     except KeyError:
	   96:         return []
	   97:     else:
	   98:         db = get_db()
	   99:         results = db.read_transaction(lambda tx: list(tx.run("MATCH (movie:Movie) "
	  100:                                                              "WHERE movie.title =~ $title "
	  101:                                                              "RETURN movie", {"title": "(?i).*" + q + ".*"}
	  102:                                                              )))
	  103:         return Response(dumps([serialize_movie(record['movie']) for record in results]),
	  104:                         mimetype="application/json")
	  107: @app.route("/movie/<title>")
	  108: def get_movie(title):
	  109:     db = get_db()
	  110:     result = db.read_transaction(lambda tx: tx.run("MATCH (movie:Movie {title:$title}) "
	  111:                                                    "OPTIONAL MATCH (movie)<-[r]-(person:Person) "
	  112:                                                    "RETURN movie.title as title,"
	  113:                                                    "COLLECT([person.name, "
	  114:                                                    "HEAD(SPLIT(TOLOWER(TYPE(r)), '_')), r.roles]) AS cast "
	  115:                                                    "LIMIT 1", {"title": title}).single())
	  117:     return Response(dumps({"title": result['title'],
	  118:                            "cast": [serialize_cast(member)
	  119:                                     for member in result['cast']]}),
	  120:                     mimetype="application/json")
	  123: @app.route("/movie/<title>/vote", methods=["POST"])
	  124: def vote_in_movie(title):
	  125:     db = get_db()
	  126:     summary = db.write_transaction(lambda tx: tx.run("MATCH (m:Movie {title: $title}) "
	  127:                                                     "WITH m, (CASE WHEN exists(m.votes) THEN m.votes ELSE 0 END) AS currentVotes "
	  128:                                                     "SET m.votes = currentVotes + 1;", {"title": title}).consume())
	  129:     updates = summary.counters.properties_set
	  131:     db.close()
	  133:     return Response(dumps({"updates": updates}), mimetype="application/json")
	  136: if __name__ == '__main__':
	  137:     logging.info('Running on port %d, database is at %s', port, url)
	  138:     app.run(port=port)

	requirements.txt
		1: Flask==2.0.1
		2: neo4j==4.3.1

	static\index.html
		1: <!DOCTYPE html>
		2: <html lang="en">
		3: <head>
		4:     <meta charset="UTF-8">
		5:     <meta name="viewport" content="width=device-width, initial-scale=1.0">
		6:     <link rel="stylesheet" href="https://neo4j-documentation.github.io/developer-resources/language-guides/assets/css/main.css">
		7:     <title>Neo4j Movies</title>
		8: </head>
	   10: <body>
	   11: <div id="graph">
	   12: </div>
	   13: <div role="navigation" class="navbar navbar-default navbar-static-top">
	   14:     <div class="container">
	   15:         <div class="row">
	   16:             <div class="col-sm-6 col-md-6">
	   17:                 <ul class="nav navbar-nav">
	   18:                     <li>
	   19:                         <form role="search" class="navbar-form" id="search">
	   20:                             <div class="form-group">
	   21:                                 <input type="text" value="Matrix" placeholder="Search for Movie Title" class="form-control" name="search">
	   22:                             </div>
	   23:                             <button class="btn btn-default" type="submit">Search</button>
	   24:                         </form>
	   25:                     </li>
	   26:                 </ul>
	   27:             </div>
	   28:             <div class="navbar-header col-sm-6 col-md-6">
	   29:                 <div class="logo-well">
	   30:                     <a href="https://neo4j.com/developer/get-started">
	   31:                     <img src="https://neo4j-documentation.github.io/developer-resources/language-guides/assets/img/logo-white.svg" alt="Neo4j World's Leading Graph Database" id="logo">
	   32:                     </a>
	   33:                 </div>
	   34:                 <div class="navbar-brand">
	   35:                     <div class="brand">Neo4j Movies</div>
	   36:                 </div>
	   37:             </div>
	   38:         </div>
	   39:     </div>
	   40: </div>
	   42: <div class="row">
	   43:     <div class="col-md-5">
	   44:         <div class="panel panel-default">
	   45:             <div class="panel-heading">Search Results</div>
	   46:             <table id="results" class="table table-striped table-hover">
	   47:                 <thead>
	   48:                 <tr>
	   49:                     <th>Movie</th>
	   50:                     <th>Released</th>
	   51:                     <th>Tagline</th>
	   52:                     <th>Votes</th>
	   53:                 </tr>
	   54:                 </thead>
	   55:                 <tbody>
	   56:                 </tbody>
	   57:             </table>
	   58:         </div>
	   59:     </div>
	   60:     <div class="col-md-7">
	   61:         <div class="panel panel-default">
	   62:             <div class="panel-heading" id="title">Details</div>
	   63:             <div class="row">
	   64:                 <div class="col-sm-4 col-md-4">
	   65:                     <img src="" class="well" id="poster"/>
	   66:                 </div>
	   67:                 <div class="col-md-8 col-sm-8">
	   68:                     <h4>Crew</h4>
	   69:                     <ul id="crew">
	   70:                     </ul>
	   71:                 </div>
	   72:             </div>
	   73:             <div class="panel-footer"><button id="vote">Vote</button></div>
	   74:         </div>
	   75:     </div>
	   76: </div>
	   77: <style type="text/css">
	   78:     .node { stroke: #222; stroke-width: 1.5px; }
	   79:     .node.actor { fill: #888; }
	   80:     .node.movie { fill: #BBB; }
	   81:     .link { stroke: #999; stroke-opacity: .6; stroke-width: 1px; }
	   82: </style>
	   84: <script type="text/javascript" src="//code.jquery.com/jquery-1.11.0.min.js"></script>
	   85: <script src="https://d3js.org/d3.v3.min.js" type="text/javascript"></script>
	   86: <script type="text/javascript">
	   87:     $(function () {
	   88:         function showMovie(title) {
	   89:             $.get("/movie/" + encodeURIComponent(title),
	   90:                     function (data) {
	   91:                         if (!data) return;
	   92:                         $("#title").text(data.title);
	   93:                         $("#poster").attr("src","https://neo4j-documentation.github.io/developer-resources/language-guides/assets/posters/"+encodeURIComponent(data.title)+".jpg");
	   94:                         const $list = $("#crew").empty();
	   95:                         data.cast.forEach(function (cast) {
	   96:                             $list.append($("<li>" + cast.name + " " +cast.job + (cast.job == "acted"?" as " + cast.role : "") + "</li>"));
	   97:                         });
	   98:                         $("#vote")
	   99:                             .unbind("click")
	  100:                             .click(function () {
	  101:                                 voteInMovie(data.title)
	  102:                             })
	  103:                     }, "json");
	  104:             return false;
	  105:         }
	  106:         function search(showFirst = true) {
	  107:             const query=$("#search").find("input[name=search]").val();
	  108:             $.get("/search?q=" + encodeURIComponent(query),
	  109:                     function (data) {
	  110:                         const t = $("table#results tbody").empty();
	  111:                         if (!data || data.length == 0) return;
	  112:                         data.forEach(function (movie, index) {
	  113:                             $("<tr><td class='movie'>" + movie.title
	  114:                                 + "</td><td>" + movie.released
	  115:                                 + "</td><td>" + movie.tagline
	  116:                                 + "</td><td id='votes" + index + "'>" + (movie.votes || 0)
	  117:                                 + "</td></tr>").appendTo(t)
	  118:                                     .click(function() { showMovie($(this).find("td.movie").text());})
	  119:                         });
	  120:                         if (showFirst) {
	  121:                             showMovie(data[0].title);
	  122:                         }
	  123:                     }, "json");
	  124:             return false;
	  125:         }
	  127:         function voteInMovie(title) {
	  128:             $.post("/movie/" + encodeURIComponent(title) + "/vote", () => {
	  129:                 search(false);
	  130:                 showMovie(title);
	  131:             });
	  132:         }
	  134:         $("#search").submit(search);
	  135:         search();
	  136:     })
	  137: </script>
	  139: <script type="text/javascript">
	  140:     const width = 800, height = 800;
	  142:     const force = d3.layout.force()
	  143:             .charge(-200).linkDistance(30).size([width, height]);
	  145:     const svg = d3.select("#graph").append("svg")
	  146:             .attr("width", "100%").attr("height", "100%")
	  147:             .attr("pointer-events", "all");
	  149:     d3.json("/graph", function(error, graph) {
	  150: 		if (error) return;
	  152:         force.nodes(graph.nodes).links(graph.links).start();
	  154:         const link = svg.selectAll(".link")
	  155:                 .data(graph.links).enter()
	  156:                 .append("line").attr("class", "link");
	  158:         const node = svg.selectAll(".node")
	  159:                 .data(graph.nodes).enter()
	  160:                 .append("circle")
	  161:                 .attr("class", function (d) { return "node "+d.label })
	  162:                 .attr("r", 10)
	  163:                 .call(force.drag);
	  165:         // html title attribute
	  166:         node.append("title")
	  167:                 .text(function (d) { return d.title; })
	  169:         // force feed algo ticks
	  170:         force.on("tick", function() {
	  171:             link.attr("x1", function(d) { return d.source.x; })
	  172:                     .attr("y1", function(d) { return d.source.y; })
	  173:                     .attr("x2", function(d) { return d.target.x; })
	  174:                     .attr("y2", function(d) { return d.target.y; });
	  176:             node.attr("cx", function(d) { return d.x; })
	  177:                     .attr("cy", function(d) { return d.y; });
	  178:         });
	  179:     });
	  180: </script>
	  181: </body>
	  182: </html>

	

		python -m venv venv

		venv\scripts\activate

		pip install -r requirements.txt

		python movies.py

	git clone https://github.com/neo4j-examples/movies-java-bolt

Project: movies-java-bolt

    pom.xml
        1: <project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        2:          xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd">
        3:     <modelVersion>4.0.0</modelVersion>
        4:     <groupId>org.neo4j.example</groupId>
        5:     <artifactId>neo4j-movies</artifactId>
        6:     <version>4.1-SNAPSHOT</version>
        7:     <packaging>jar</packaging>
        8:     <name>Neo4j Movies Demo</name>
        9:     <description>Neo4j Movies Demo App</description>
       10:     <url>http://github.com/neo4j-examples/neo4j-movies-java-bolt</url>
       12:     <properties>
       13:         <encoding>UTF-8</encoding>
       14:         <project.build.sourceEncoding>${encoding}</project.build.sourceEncoding>
       15:         <project.reporting.outputEncoding>${encoding}</project.reporting.outputEncoding>
       16:         <maven.compiler.release>11</maven.compiler.release>
       17:     </properties>
       19:     <dependencyManagement>
       20:         <dependencies>
       21:             <dependency>
       22:                 <groupId>org.junit</groupId>
       23:                 <artifactId>junit-bom</artifactId>
       24:                 <version>5.7.2</version>
       25:                 <type>pom</type>
       26:                 <scope>import</scope>
       27:             </dependency>
       28:         </dependencies>
       29:     </dependencyManagement>
       31:     <dependencies>
       32: <!-- tag::bolt-dependency[] -->
       33:         <dependency>
       34:             <groupId>org.neo4j.driver</groupId>
       35:             <artifactId>neo4j-java-driver</artifactId>
       36:             <version>4.3.0</version>
       37:         </dependency>
       38: <!-- end::bolt-dependency[] -->
       39:         <dependency>
       40:             <groupId>com.sparkjava</groupId>
       41:             <artifactId>spark-core</artifactId>
       42:             <version>2.9.3</version>
       43:         </dependency>
       44:         <dependency>
       45:             <groupId>com.google.code.gson</groupId>
       46:             <artifactId>gson</artifactId>
       47:             <version>2.8.7</version>
       48:         </dependency>
       49:     </dependencies>
       51:     <build>
       52:         <plugins>
       53:             <plugin>
       54:                 <artifactId>maven-compiler-plugin</artifactId>
       55:                 <version>3.8.1</version>
       56:             </plugin>
       57:             <plugin>
       58:                 <artifactId>maven-surefire-plugin</artifactId>
       59:                 <version>2.22.2</version>
       60:             </plugin>
       61:             <plugin>
       62:                 <groupId>org.codehaus.mojo</groupId>
       63:                 <artifactId>appassembler-maven-plugin</artifactId>
       64:                 <version>2.1.0</version>
       65:                 <executions>
       66:                     <execution>
       67:                         <phase>package</phase>
       68:                         <goals>
       69:                             <goal>assemble</goal>
       70:                         </goals>
       71:                         <configuration>
       72:                             <assembleDirectory>target</assembleDirectory>
       73:                             <extraJvmArguments>-Xmx512m</extraJvmArguments>
       74:                             <programs>
       75:                                 <program>
       76:                                     <mainClass>example.movies.backend.MovieServer</mainClass>
       77:                                     <name>webapp</name>
       78:                                 </program>
       79:                             </programs>
       80:                         </configuration>
       81:                     </execution>
       82:                 </executions>
       83:             </plugin>
       84:             <plugin>
       85:                 <groupId>org.codehaus.mojo</groupId>
       86:                 <artifactId>exec-maven-plugin</artifactId>
       87:                 <version>3.0.0</version>
       88:                 <executions>
       89:                     <execution>
       90:                         <goals>
       91:                             <goal>java</goal>
       92:                         </goals>
       93:                     </execution>
       94:                 </executions>
       95:                 <configuration>
       96:                     <mainClass>example.movies.backend.MovieServer</mainClass>
       97:                 </configuration>
       98:             </plugin>
       99:         </plugins>
      100:     </build>
      101: </project>

    src\main\java\example\movies\Environment.java
        1: package example.movies;
        3: /**
        4:  * @author Michael Hunger @since 22.10.13
        5:  */
        6: public class Environment {
        8:     private static final String DEFAULT_URL = "neo4j+s://demo.neo4jlabs.com";
       10:     private static final String DEFAULT_DATABASE = "movies";
       12:     private static final String DEFAULT_USER = "movies";
       14:     private static final String DEFAULT_PASS = "movies";
       16:     public static int getPort() {
       17:         String webPort = System.getenv("PORT");
       18:         if (webPort == null || webPort.isEmpty()) {
       19:             return 8080;
       20:         }
       21:         return Integer.parseInt(webPort);
       22:     }
       24:     public static String getNeo4jUrl() {
       25:         String url = System.getenv("NEO4J_URI");
       26:         if (url == null || url.isEmpty()) {
       27:             return DEFAULT_URL;
       28:         }
       29:         return url;
       30:     }
       32:     public static String getNeo4jDatabase() {
       33:         String neo4jVersion = System.getenv("NEO4J_VERSION");
       34:         if (neo4jVersion == null || neo4jVersion.startsWith("4")) {
       35:             String database = System.getenv("NEO4J_DATABASE");
       36:             if (database == null || database.isEmpty()) {
       37:                 return DEFAULT_DATABASE;
       38:             }
       39:             return database;
       40:         }
       41:         return null;
       42:     }
       44:     public static String getNeo4jUsername() {
       45:         String user = System.getenv("NEO4J_USER");
       46:         if (user == null || user.isEmpty()) {
       47:             return DEFAULT_USER;
       48:         }
       49:         return user;
       50:     }
       52:     public static String getNeo4jPassword() {
       53:         String password = System.getenv("NEO4J_PASSWORD");
       54:         if (password == null || password.isEmpty()) {
       55:             return DEFAULT_PASS;
       56:         }
       57:         return password;
       58:     }
       59: }

    src\main\java\example\movies\backend\MovieRoutes.java
        1: package example.movies.backend;
        3: import com.google.gson.Gson;
        4: import com.google.gson.GsonBuilder;
        5: import spark.Request;
        6: import spark.Response;
        7: import spark.Route;
        8: import spark.servlet.SparkApplication;
       10: import java.net.URLDecoder;
       11: import java.nio.charset.StandardCharsets;
       12: import java.util.Map;
       14: import static spark.Spark.get;
       15: import static spark.Spark.post;
       17: public class MovieRoutes implements SparkApplication {
       19:     private final Gson gson = new GsonBuilder().disableHtmlEscaping().create();
       21:     private final MovieService service;
       23:     public MovieRoutes(MovieService service) {
       24:         this.service = service;
       25:     }
       27:     public void init() {
       28:         get("/movie/:title", (req, res) -> gson.toJson(service.findMovie(URLDecoder.decode(req.params("title"), StandardCharsets.UTF_8))));
       29:         post("/movie/:title/vote", (req, res) -> {
       30:             Integer updates = service.voteInMovie(URLDecoder.decode(req.params("title"), StandardCharsets.UTF_8));
       31:             return gson.toJson( Map.of("updated", updates));
       32:         });
       33:         get("/search", (req, res) -> gson.toJson(service.search(req.queryParams("q"))));
       34:         get("/graph", (req, res) -> {
       35:             int limit = req.queryParams("limit") != null ? Integer.parseInt(req.queryParams("limit")) : 100;
       36:             return gson.toJson(service.graph(limit));
       37:         });
       38:     }
       39: }

    src\main\java\example\movies\backend\MovieServer.java
        1: package example.movies.backend;
        3: import example.movies.Environment;
        4: import org.neo4j.driver.AuthTokens;
        5: import org.neo4j.driver.Driver;
        6: import org.neo4j.driver.GraphDatabase;
        7: import spark.Spark;
        9: import static spark.Spark.externalStaticFileLocation;
       11: /**
       12:  * @author Michael Hunger @since 22.10.13
       13:  */
       14: public class MovieServer {
       16:     public static void main(String[] args) {
       17:         Spark.port(Environment.getPort());
       18:         externalStaticFileLocation("src/main/webapp");
       19:         var driver = GraphDatabase.driver(
       20:                 Environment.getNeo4jUrl(),
       21:                 AuthTokens.basic(Environment.getNeo4jUsername(), Environment.getNeo4jPassword())
       22:         );
       23:         var service = new MovieService(driver, Environment.getNeo4jDatabase());
       24:         new MovieRoutes(service).init();
       26:         Runtime.getRuntime().addShutdownHook(new Thread(driver::close));
       27:     }
       28: }

    src\main\java\example\movies\backend\MovieService.java
        1: package example.movies.backend;
        3: import org.neo4j.driver.Driver;
        4: import org.neo4j.driver.Result;
        5: import org.neo4j.driver.Session;
        6: import org.neo4j.driver.SessionConfig;
        7: import org.neo4j.driver.Value;
        8: import org.neo4j.driver.summary.ResultSummary;
       10: import java.util.ArrayList;
       11: import java.util.Collection;
       12: import java.util.Collections;
       13: import java.util.List;
       14: import java.util.Map;
       16: /**
       17:  * @author mh
       18:  * @since 30.05.12
       19:  */
       20: public class MovieService {
       22:     private final Driver driver;
       24:     private final String database;
       26:     public MovieService(Driver driver, String database) {
       27:         this.driver = driver;
       28:         this.database = database;
       29:     }
       31:     public Map<String, Object> findMovie(String title) {
       32:         if (title == null) return Map.of();
       33:         var result = query(
       34:                 "MATCH (movie:Movie {title:$title})" +
       35:                         " OPTIONAL MATCH (movie)<-[r]-(person:Person)\n" +
       36:                         " RETURN movie.title as title, collect({name:person.name, job:head(split(toLower(type(r)),'_')), role:r.roles}) as cast LIMIT 1",
       37:                 Map.of("title", title));
       38:         return result.isEmpty() ? Map.of() : result.get(0);
       39:     }
       41:     public Integer voteInMovie(String title) {
       42:         if (title == null) return 0;
       43:         try (Session session = getSession()) {
       44:             return session.writeTransaction( tx -> {
       45:                 Result result = tx.run(
       46:                         "MATCH (m:Movie {title: $title}) " +
       47:                         "WITH m, (CASE WHEN exists(m.votes) THEN m.votes ELSE 0 END) AS currentVotes " +
       48:                         "SET m.votes = currentVotes + 1;", Map.of("title", title) );
       49:                 ResultSummary summary = result.consume();
       50:                 return summary.counters().propertiesSet();
       51:             } );
       52:         }
       53:     }
       55:     public Iterable<Map<String, Object>> search(String query) {
       56:         if (query == null || query.trim().isEmpty()) return Collections.emptyList();
       57:         return query(
       58:                 "MATCH (movie:Movie)\n" +
       59:                         " WHERE toLower(movie.title) CONTAINS $part\n" +
       60:                         " RETURN movie",
       61:                 Map.of("part", query.toLowerCase()));
       62:     }
       64:     public Map<String, Object> graph(int limit) {
       65:         var result = query(
       66:                 "MATCH (m:Movie)<-[:ACTED_IN]-(a:Person) " +
       67:                         " RETURN m.title as movie, collect(a.name) as cast " +
       68:                         " LIMIT $limit", Map.of("limit", limit));
       70:         List<Map<String, Object>> nodes = new ArrayList<>();
       71:         List<Map<String, Object>> rels = new ArrayList<>();
       72:         int i = 0;
       73:         for (var row : result) {
       74:             nodes.add(Map.of("title", row.get("movie"), "label", "movie"));
       75:             int target = i;
       76:             i++;
       77:             for (Object name : (Collection<?>) row.get("cast")) {
       78:                 Map<String, Object> actor = Map.of("title", name, "label", "actor");
       79:                 int source = nodes.indexOf(actor);
       80:                 if (source == -1) {
       81:                     nodes.add(actor);
       82:                     source = i++;
       83:                 }
       84:                 rels.add(Map.of("source", source, "target", target));
       85:             }
       86:         }
       87:         return Map.of("nodes", nodes, "links", rels);
       88:     }
       90:     private List<Map<String, Object>> query(String query, Map<String, Object> params) {
       91:         try (Session session = getSession()) {
       92:             return session.readTransaction(
       93:                     tx -> tx.run(query, params).list(r -> r.asMap(MovieService::convert))
       94:             );
       95:         }
       96:     }
       98:     private Session getSession() {
       99:         if (database == null || database.isBlank()) return driver.session();
      100:         return driver.session(SessionConfig.forDatabase(database));
      101:     }
      103:     private static Object convert(Value value) {
      104:         switch (value.type().name()) {
      105:             case "PATH":
      106:                 return value.asList(MovieService::convert);
      107:             case "NODE":
      108:             case "RELATIONSHIP":
      109:                 return value.asMap();
      110:         }
      111:         return value.asObject();
      112:     }
      113: }

    src\main\resources\log4j.properties
        1: log4j.appender.STDOUT=org.apache.log4j.ConsoleAppender
        2: log4j.appender.STDOUT.layout=org.apache.log4j.PatternLayout
        3: log4j.appender.STDOUT.layout.conversionPattern=%d %-5p - %-26.26c{1} - %m\n
        5: # Specific
        6: log4j.logger.spark=DEBUG,STDOUT
        7: log4j.logger.org.neo4j=DEBUG,STDOUT
        8: log4j.logger.org.eclipse.jetty=WARN,STDOUT
       10: # log4j.rootLogger=WARN,STDOUT

    src\main\webapp\index.html
        1: <html>
        2: <head>
        3:     <meta name="viewport" content="width=device-width, initial-scale=1.0">
        4:     <link rel="stylesheet" href="https://neo4j-documentation.github.io/developer-resources/language-guides/assets/css/main.css">
        5:     <title>Neo4j Movies</title>
        6: </head>
        8: <body>
        9: <div id="graph">
       10: </div>
       11: <div role="navigation" class="navbar navbar-default navbar-static-top">
       12:     <div class="container">
       13:         <div class="row">
       14:             <div class="col-sm-6 col-md-6">
       15:                 <ul class="nav navbar-nav">
       16:                     <li>
       17:                         <form role="search" class="navbar-form" id="search">
       18:                             <div class="form-group">
       19:                                 <input type="text" value="Matrix" placeholder="Search for Movie Title" class="form-control" name="search">
       20:                             </div>
       21:                             <button class="btn btn-default" type="submit">Search</button>
       22:                         </form>
       23:                     </li>
       24:                 </ul>
       25:             </div>
       26:             <div class="navbar-header col-sm-6 col-md-6">
       27:                 <div class="logo-well">
       28:                     <a href="https://neo4j.com/developer/example-project" target="_blank">
       29:                     <img src="https://neo4j.com/wp-content/themes/neo4jweb/template-partials/brand/assets/neo4j-icon-color.png" alt="Neo4j World's Leading Graph Database" id="logo">
       30:                     </a>
       31:                 </div>
       32:                 <div class="navbar-brand">
       33:                     <div class="brand">Neo4j Movies</div>
       34:                 </div>
       35:             </div>
       36:         </div>
       37:     </div>
       38: </div>
       40: <div class="row">
       41:     <div class="col-md-5">
       42:         <div class="panel panel-default">
       43:             <div class="panel-heading">Search Results</div>
       44:             <table id="results" class="table table-striped table-hover">
       45:                 <thead>
       46:                 <tr>
       47:                     <th>Movie</th>
       48:                     <th>Released</th>
       49:                     <th>Tagline</th>
       50:                     <th>Votes</th>
       51:                 </tr>
       52:                 </thead>
       53:                 <tbody>
       54:                 </tbody>
       55:             </table>
       56:         </div>
       57:     </div>
       58:     <div class="col-md-7">
       59:         <div class="panel panel-default">
       60:             <div class="panel-heading" id="title">Details</div>
       61:             <div class="row">
       62:                 <div class="col-sm-4 col-md-4">
       63:                     <img src="" class="well" id="poster"/>
       64:                 </div>
       65:                 <div class="col-md-8 col-sm-8">
       66:                     <h4>Crew</h4>
       67:                     <ul id="crew">
       68:                     </ul>
       69:                 </div>
       70:             </div>
       71:             <div class="panel-footer"><button id="vote">Vote</button></div>
       72:         </div>
       73:     </div>
       74: </div>
       75: <style type="text/css">
       76:     .node { stroke: #222; stroke-width: 1.5px; }
       77:     .node.actor { fill: #888; }
       78:     .node.movie { fill: #BBB; }
       79:     .link { stroke: #999; stroke-opacity: .6; stroke-width: 1px; }
       80: </style>
       82: <script type="text/javascript" src="//code.jquery.com/jquery-1.11.0.min.js"></script>
       83: <script src="https://d3js.org/d3.v3.min.js" type="text/javascript"></script>
       84: <script type="text/javascript">
       85:     $(function () {
       86:         function showMovie(title) {
       87:             $.get("/movie/" + encodeURIComponent(title),
       88:                     function (data) {
       89:                         if (!data) return;
       90:                         $("#title").text(data.title);
       91:                         $("#poster").attr("src","https://neo4j-documentation.github.io/developer-resources/language-guides/assets/posters/"+encodeURIComponent(data.title)+".jpg");
       92:                         var $list = $("#crew").empty();
       93:                         data.cast.forEach(function (cast) {
       94:                             $list.append($("<li>" + cast.name + " " +cast.job + (cast.job == "acted"?" as " + cast.role : "") + "</li>"));
       95:                         });
       96:                         $("#vote")
       97:                             .unbind("click")
       98:                             .click(function () {
       99:                                 voteInMovie(data.title)
      100:                             })
      101:                     }, "json");
      102:             return false;
      103:         }
      104:         function search(showFirst = true) {
      105:             var query=$("#search").find("input[name=search]").val();
      106:             $.get("/search?q=" + encodeURIComponent(query),
      107:                     function (data) {
      108:                         var t = $("table#results tbody").empty();
      109:                         if (!data || data.length == 0) return;
      110:                         data.forEach(function (row, index) {
      111:                             var movie = row.movie;
      112:                             $("<tr><td class='movie'>" + movie.title
      113:                                 + "</td><td>" + movie.released
      114:                                 + "</td><td>" + movie.tagline
      115:                                 + "</td><td id='votes" + index + "'>" + (movie.votes || 0)
      116:                                 + "</td></tr>").appendTo(t)
      117:                                     .click(function() { showMovie($(this).find("td.movie").text());})
      118:                         });
      119:                         if (showFirst) {
      120:                             showMovie(data[0].movie.title);
      121:                         }
      122:                     }, "json");
      123:             return false;
      124:         }
      126:         function voteInMovie(title) {
      127:             $.post("/movie/" + encodeURIComponent(title) + "/vote", () => {
      128:                 search(false);
      129:                 showMovie(title);
      130:             });
      131:         }
      133:         $("#search").submit(search);
      134:         search();
      135:     })
      136: </script>
      138: <script type="text/javascript">
      139:     var width = 800, height = 800;
      141:     var force = d3.layout.force()
      142:             .charge(-200).linkDistance(30).size([width, height]);
      144:     var svg = d3.select("#graph").append("svg")
      145:             .attr("width", "100%").attr("height", "100%")
      146:             .attr("pointer-events", "all");
      148:     d3.json("/graph", function(error, graph) {
      149: 		if (error) return;
      151:         force.nodes(graph.nodes).links(graph.links).start();
      153:         var link = svg.selectAll(".link")
      154:                 .data(graph.links).enter()
      155:                 .append("line").attr("class", "link");
      157:         var node = svg.selectAll(".node")
      158:                 .data(graph.nodes).enter()
      159:                 .append("circle")
      160:                 .attr("class", function (d) { return "node "+d.label })
      161:                 .attr("r", 10)
      162:                 .call(force.drag);
      164:         // html title attribute
      165:         node.append("title")
      166:                 .text(function (d) { return d.title; })
      168:         // force feed algo ticks
      169:         force.on("tick", function() {
      170:             link.attr("x1", function(d) { return d.source.x; })
      171:                     .attr("y1", function(d) { return d.source.y; })
      172:                     .attr("x2", function(d) { return d.target.x; })
      173:                     .attr("y2", function(d) { return d.target.y; });
      175:             node.attr("cx", function(d) { return d.x; })
      176:                     .attr("cy", function(d) { return d.y; });
      177:         });
      178:     });
      179: </script>
      180: </body>
      181: </html>

    system.properties
        1: java.runtime.version=11

	git clone https://github.com/neo4j-examples/movies-dotnet-bolt
